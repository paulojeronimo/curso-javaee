<?xml version="1.0" encoding="utf-8"?>

<project name="remote-deploy" default="deploy">
  <property environment="env"/>
  <property name="remote.host" value="${env.SERVIDOR_REMOTO}"/>
  <property name="remote.username" value="${env.USUARIO_REMOTO}"/>
  <property name="lab.dir" value="${env.LAB_DIR}"/>
  <property file="${remote-deploy.properties}"/>

  <fileset id="deploy.fileset" dir="${target.dir}" includes="${deploy.includes}" excludes="${dependency.dir}/**,${deploy.excludes}"/>
  <fileset id="lib.fileset" dir="${target.dir}/${dependency.dir}" includes="${lib.includes}" excludes="${lib.excludes}"/>

  <target name="copy-deploy">
    <echo>deploy.fileset=${toString:deploy.fileset}</echo>
    <echo>remote.jboss.deploy.dir=${remote.jboss.deploy.dir}</echo>
    <scp trust="yes" todir="${remote.jboss.deploy.dir}" keyfile="${user.home}/.ssh/id_rsa" passphrase="">
      <fileset refid="deploy.fileset"/>
    </scp>
  </target>

  <target name="copy-lib">
    <echo>lib.fileset=${toString:lib.fileset}</echo>
    <echo>remote.jboss.lib.dir=${remote.jboss.lib.dir}</echo>
    <scp trust="yes" todir="${remote.jboss.lib.dir}" keyfile="${user.home}/.ssh/id_rsa" passphrase="">
      <fileset refid="lib.fileset"/>
    </scp>
  </target>

  <target name="deploy" depends="copy-lib,copy-deploy">
    <sshexec trust="yes" host="${remote.host}" username="${remote.username}" 
      keyfile="${user.home}/.ssh/id_rsa" passphrase="" command="${remote.sincronizar-cluster}"/>
  </target>
</project>
